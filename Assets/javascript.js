// Sidebar toggle (mobile)
const menuBtn = document.getElementById('menuBtn');
const sidebar = document.getElementById('sidebar');
const menuCloseBtns = document.querySelectorAll('.menuClose');

// Open / Toggle
menuBtn.addEventListener('click', () => {
  sidebar.classList.toggle('open');
});

// Close (for all close buttons)
menuCloseBtns.forEach(btn => {
  btn.addEventListener('click', () => {
    sidebar.classList.remove('open');
  });
});



    // Theme toggle with localStorage
    const themeBtn = document.getElementById('themeBtn');
    const themeLabel = document.getElementById('themeLabel');

    function setTheme(mode){
      document.documentElement.setAttribute('data-theme', mode);
      localStorage.setItem('theme', mode);
      themeLabel.textContent = (mode === 'dark') ? '‡¶≤‡¶æ‡¶á‡¶ü' : ' ‡¶°‡¶æ‡¶∞‡ßç‡¶ï ';
    }
    const saved = localStorage.getItem('theme');
    setTheme(saved || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'));

    themeBtn.addEventListener('click', ()=>{
      const current = document.documentElement.getAttribute('data-theme');
      setTheme(current === 'light' ? 'dark' : 'light');
    });


    // ‡¶≤‡ßá‡¶ñ‡¶æ ‡¶ö‡¶≤‡¶æ   ###################################################

let runningFont = document.getElementById("runFont")
runningFont.innerText = " ‡¶∞‡¶æ‡¶¨‡ßç‡¶¨‡¶ø ‡¶ú‡¶ø‡¶¶‡¶®‡¶ø ‡¶á‡¶≤‡¶Æ‡¶æ üíé ‡¶∞‡¶æ‡¶¨‡ßç‡¶¨‡¶ø ‡¶ú‡¶ø‡¶¶‡¶®‡¶ø ‡¶á‡¶≤‡¶Æ‡¶æ üíé ‡¶∞‡¶æ‡¶¨‡ßç‡¶¨‡¶ø ‡¶ú‡¶ø‡¶¶‡¶®‡¶ø ‡¶á‡¶≤‡¶Æ‡¶æ üíé ‡¶Ü‡¶≤‡ßç‡¶≤‡¶æ‡¶π‡¶á ‡¶Ø‡¶•‡ßá‡¶∑‡ßç‡¶ü : ‚Äò‡¶π‡¶æ‡¶∏‡¶¨‡ßÅ‡¶®‡¶æ‡¶≤‡ßç‡¶≤‡¶æ‡¶π‡ßÅ ‡¶ì‡ßü‡¶æ ‡¶®‡¶ø‡¶Æ‡¶æ‡¶≤ ‡¶ì‡ßü‡¶æ‡¶ï‡¶ø‡¶≤, ‡¶®‡¶ø‡¶Æ‡¶æ‡¶≤ ‡¶Æ‡¶æ‡¶ì‡¶≤‡¶æ ‡¶ì‡ßü‡¶æ ‡¶®‡¶ø‡¶Æ‡¶æ‡¶® ‡¶®‡¶æ‡¶∏‡¶ø‡¶∞‡•§‚Äô üíé ";

// Accessible Accordion ###################################################
const headers = document.querySelectorAll('.accordion-header');

headers.forEach((btn) => {
  btn.addEventListener('click', () => togglePanel(btn));
  btn.addEventListener('keydown', (e) => {
    if(e.key === 'Enter' || e.key === ' '){ 
      e.preventDefault(); 
      togglePanel(btn); 
    }
  });
});

function togglePanel(btn){
  const expanded = btn.getAttribute('aria-expanded') === 'true';
  const panelId = btn.getAttribute('aria-controls');
  const panel = document.getElementById(panelId);

  // ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶Ü‡¶á‡¶ü‡ßá‡¶Æ‡¶ü‡¶ø ‡¶ü‡¶ó‡¶≤ ‡¶ï‡¶∞‡ßÅ‡¶®
  btn.setAttribute('aria-expanded', String(!expanded));
  panel.classList.toggle('open');

      // Smooth scroll into view when opened on mobile
      if(!expanded){
        setTimeout(()=>{ panel.scrollIntoView({behavior:'smooth', block:'nearest'}); }, 200);
      }
    }

// ‡¶∂‡ßá‡ßü‡¶æ‡¶∞ ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶®‡ßç‡¶ü  ###################################################

document.addEventListener("DOMContentLoaded", function() {
  const items = document.querySelectorAll(".dua-card");

  items.forEach(item => {
    const refDiv = item.querySelector(".ref");

    if (refDiv) {
      // ‡¶∂‡ßá‡ßü‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶ï‡¶® ‡¶§‡ßà‡¶∞‡¶ø
      const shareIcon = document.createElement("i");
      shareIcon.className = "fa fa-share-alt";
      shareIcon.style.marginLeft = "8px";
      shareIcon.style.cursor = "pointer";
      shareIcon.setAttribute("title", "‡¶∂‡ßá‡ßü‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®");

      // ‡¶∞‡ßá‡¶´ div ‡¶è ‡¶¨‡¶∏‡¶æ‡¶®‡ßã
      refDiv.appendChild(shareIcon);

      // ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü
      shareIcon.addEventListener("click", async function() {
        // accordion-item ‡¶è‡¶∞ ‡¶≤‡ßá‡¶ñ‡¶æ‡¶ó‡ßÅ‡¶≤‡¶ø (HTML ‡¶¨‡¶æ‡¶¶ ‡¶¶‡¶ø‡ßü‡ßá, ‡¶≤‡¶æ‡¶á‡¶® ‡¶Æ‡ßá‡¶á‡¶®‡¶ü‡ßá‡¶® ‡¶ï‡¶∞‡ßá)
        const textContent = item.innerText.trim();

        // ‡¶∏‡¶æ‡¶á‡¶ü ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶∂‡ßá‡¶∑‡ßá ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ
        const shareText = `${textContent}\n\n‡¶Ü‡¶∞‡ßã ‡¶è‡¶Æ‡¶® ‡¶§‡¶•‡ßç‡¶Ø ‡¶ì ‡¶π‡¶æ‡¶¶‡¶ø‡¶∏ ‡¶™‡ßá‡¶§‡ßá ‡¶≠‡¶ø‡¶ú‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®:\n${window.location.href}`;

        if (navigator.share) {
          try {
            await navigator.share({
              title: document.title,
              text: shareText
            });
          } catch (err) {
            console.log("‡¶∂‡ßá‡ßü‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤:", err);
          }
        } else {
          // fallback: ‡¶ï‡ßç‡¶≤‡¶ø‡¶™‡¶¨‡ßã‡¶∞‡ßç‡¶°‡ßá ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡ßá ‡¶¶‡ßá‡ßü‡¶æ
          navigator.clipboard.writeText(shareText);
          alert("‡¶∂‡ßá‡ßü‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶®‡ßá‡¶á, ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü ‡¶ï‡ßç‡¶≤‡¶ø‡¶™‡¶¨‡ßã‡¶∞‡ßç‡¶°‡ßá ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§");
        }
      });
    }
  });
});

   // idenhi ivdi balvisi likki 10 arba   ###################################################

var clickCount = 0;
var clickDiv = document.getElementById("clickDiv");
var hiddenDiv = document.getElementById("hdn");

if (!clickDiv || !hiddenDiv) {
  console.error("Could not find clickDiv or hiddenDiv");
} else {
  clickDiv.addEventListener("click", function() {
    clickCount++;
    if (clickCount === 5) {
      hiddenDiv.style.display = "block";
    }
  });
}

          //app shortcut          ###################################################
// Service Worker ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("../sw.js")
    .then(() => console.log("SW registered"))
    .catch(err => console.log("SW fail", err));
}


let deferredPrompt;
const installBtn = document.getElementById('installBtn');

// Install prompt event ‡¶ß‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø
window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  deferredPrompt = e;

  // ‡¶¨‡¶æ‡¶ü‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ‡¶ì
  installBtn.style.display = 'inline-block';
});

// ‡¶¨‡¶æ‡¶ü‡¶®‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡¶≤‡ßá prompt ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá
installBtn.addEventListener('click', () => {
  installBtn.style.display = 'none';
  deferredPrompt.prompt();

  deferredPrompt.userChoice.then((choiceResult) => {
    if (choiceResult.outcome === 'accepted') {
      console.log('‚úÖ User accepted install');
    } else {
      console.log('‚ùå User dismissed install');
    }
    deferredPrompt = null;
  });
});




// JavaScript code to create a dynamic Qibla compass inside #compasQ  ###################################################

// ‡¶ï‡¶Æ‡ßç‡¶™‡¶æ‡¶∏ ‡¶ï‡¶®‡¶´‡¶ø‡¶ó‡¶æ‡¶∞‡ßá‡¶∂‡¶®
const config = {
    size: 300,
    circleWidth: 10,
    majorTickLength: 20,
    minorTickLength: 10,
    font: '16px Arial',
    colors: {
        background: '#f5f5f5',
        circle: '#333',
        needle: 'red',
        north: '#d00',
        east: '#00d',
        south: '#0a0',
        west: '#d60',
        text: '#333'
    }
};

// ‡¶ï‡¶Æ‡ßç‡¶™‡¶æ‡¶∏ ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶á‡¶®‡¶æ‡¶∞ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®
const compasContainer = document.getElementById('compasQ');
const canvas = document.createElement('canvas');
canvas.width = config.size;
canvas.height = config.size;
canvas.style.display = 'block';
canvas.style.margin = '0 auto';
compasContainer.appendChild(canvas);

const ctx = canvas.getContext('2d');
const centerX = canvas.width / 2;
const centerY = canvas.height / 2;
const radius = (canvas.width / 2) - config.circleWidth;

let currentHeading = 0;

// ‡¶ï‡¶Æ‡ßç‡¶™‡¶æ‡¶∏ ‡¶Ü‡¶Å‡¶ï‡ßÅ‡¶®
function drawCompass(heading) {
    // ‡¶ï‡ßç‡¶Ø‡¶æ‡¶®‡¶≠‡¶æ‡¶∏ ‡¶™‡¶∞‡¶ø‡¶∑‡ßç‡¶ï‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    // ‡¶¨‡¶æ‡¶á‡¶∞‡ßá‡¶∞ ‡¶¨‡ßÉ‡¶§‡ßç‡¶§ ‡¶Ü‡¶Å‡¶ï‡ßÅ‡¶®
    ctx.beginPath();
    ctx.arc(centerX, centerY, radius + config.circleWidth, 0, 2 * Math.PI);
    ctx.fillStyle = config.colors.background;
    ctx.fill();
    ctx.strokeStyle = config.colors.circle;
    ctx.lineWidth = config.circleWidth;
    ctx.stroke();
    
    // ‡¶°‡¶ø‡¶ó‡ßç‡¶∞‡ßÄ ‡¶è‡¶¨‡¶Ç ‡¶¶‡¶ø‡¶ï‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡ßá‡¶∂ ‡¶Ü‡¶Å‡¶ï‡ßÅ‡¶®
    for (let i = 0; i < 360; i += 5) {
        const angle = (i - heading) * Math.PI / 180;
        const sin = Math.sin(angle);
        const cos = Math.cos(angle);
        
        // ‡¶™‡ßç‡¶∞‡¶ß‡¶æ‡¶® ‡¶ü‡¶ø‡¶ï ‡¶ö‡¶ø‡¶π‡ßç‡¶® (‡¶™‡ßç‡¶∞‡¶§‡¶ø 30 ‡¶°‡¶ø‡¶ó‡ßç‡¶∞‡ßÄ)
        if (i % 30 === 0) {
            ctx.lineWidth = 3;
            ctx.strokeStyle = config.colors.circle;
            
            // ‡¶ü‡¶ø‡¶ï ‡¶ö‡¶ø‡¶π‡ßç‡¶® ‡¶Ü‡¶Å‡¶ï‡ßÅ‡¶®
            ctx.beginPath();
            ctx.moveTo(centerX + sin * (radius - config.majorTickLength), centerY - cos * (radius - config.majorTickLength));
            ctx.lineTo(centerX + sin * radius, centerY - cos * radius);
            ctx.stroke();
            
            // ‡¶¶‡¶ø‡¶ï‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡ßá‡¶∂ ‡¶≤‡ßá‡¶¨‡ßá‡¶≤
            let direction = '';
            let color = config.colors.text;
            
            if (i === 0) {
                direction = 'N';
                color = config.colors.north;
            } else if (i === 90) {
                direction = 'E';
                color = config.colors.east;
            } else if (i === 180) {
                direction = 'S';
                color = config.colors.south;
            } else if (i === 270) {
                direction = 'W';
                color = config.colors.west;
            } else {
                direction = i.toString();
            }
            
            // ‡¶≤‡ßá‡¶¨‡ßá‡¶≤ ‡¶Ü‡¶Å‡¶ï‡ßÅ‡¶®
            ctx.font = config.font;
            ctx.fillStyle = color;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(direction, centerX + sin * (radius - config.majorTickLength - 20), centerY - cos * (radius - config.majorTickLength - 20));
        } 
        // ‡¶õ‡ßã‡¶ü ‡¶ü‡¶ø‡¶ï ‡¶ö‡¶ø‡¶π‡ßç‡¶®
        else {
            ctx.lineWidth = 1;
            ctx.strokeStyle = config.colors.circle;
            
            ctx.beginPath();
            ctx.moveTo(centerX + sin * (radius - config.minorTickLength), centerY - cos * (radius - config.minorTickLength));
            ctx.lineTo(centerX + sin * radius, centerY - cos * radius);
            ctx.stroke();
        }
    }
    
    // ‡¶ï‡¶Æ‡ßç‡¶™‡¶æ‡¶∏ ‡¶∏‡ßÅ‡¶á ‡¶Ü‡¶Å‡¶ï‡ßÅ‡¶®
    ctx.beginPath();
    ctx.moveTo(centerX, centerY - radius + 20);
    ctx.lineTo(centerX - 10, centerY);
    ctx.lineTo(centerX, centerY + 10);
    ctx.lineTo(centerX + 10, centerY);
    ctx.closePath();
    ctx.fillStyle = config.colors.needle;
    ctx.fill();
    
    // ‡¶ï‡ßá‡¶®‡ßç‡¶¶‡ßç‡¶∞‡ßÄ‡¶Ø‡¶º ‡¶¨‡¶ø‡¶®‡ßç‡¶¶‡ßÅ ‡¶Ü‡¶Å‡¶ï‡ßÅ‡¶®
    ctx.beginPath();
    ctx.arc(centerX, centerY, 5, 0, 2 * Math.PI);
    ctx.fillStyle = config.colors.circle;
    ctx.fill();
}

// ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏ ‡¶ì‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü‡ßá‡¶∂‡¶® ‡¶∂‡¶®‡¶æ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®
if (window.DeviceOrientationEvent) {
    window.addEventListener('deviceorientation', function(event) {
        // ‡¶ï‡¶Æ‡ßç‡¶™‡¶æ‡¶∏ ‡¶π‡ßá‡¶°‡¶ø‡¶Ç ‡¶®‡¶ø‡¶® (‡¶°‡¶ø‡¶ó‡ßç‡¶∞‡ßÄ‡¶§‡ßá)
        if (event.alpha !== null) {
            currentHeading = event.alpha; // iOS ‡¶è‡¶¨‡¶Ç ‡¶ï‡¶ø‡¶õ‡ßÅ Android ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏
        } else if (event.webkitCompassHeading !== undefined) {
            currentHeading = event.webkitCompassHeading; // iOS WebKit
        }
        
        // ‡¶ï‡¶Æ‡ßç‡¶™‡¶æ‡¶∏ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®
        drawCompass(currentHeading);
    }, false);
} else {
    // ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏ ‡¶ì‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü‡ßá‡¶∂‡¶® ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ï‡¶∞‡ßá ‡¶®‡¶æ
    ctx.font = '20px Arial';
    ctx.fillStyle = config.colors.text;
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText('‡¶ï‡¶Æ‡ßç‡¶™‡¶æ‡¶∏ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏‡ßá ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ï‡¶∞‡ßá ‡¶®‡¶æ', centerX, centerY);
}

// ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡¶¨‡¶æ‡¶∞ ‡¶ï‡¶Æ‡ßç‡¶™‡¶æ‡¶∏ ‡¶Ü‡¶Å‡¶ï‡ßÅ‡¶®
drawCompass(currentHeading);
